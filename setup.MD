
# Datahub POC

# Pre-requisites
	Java 21
	Docker
	Python
	IDE (Optional)
	
# Set-up

## Kafka
	execute docker-compose using the yaml file in Docker/compose_yaml
	"docker-compose -f .\docker-kafka.yml up"
	
	- This starts Kafka with advertised listener to port 9092
	- It also includes Kafka-UI (http://localhost:18080/), web-based GUI for managing Kafka topics, messages, and brokers.

## DatahubPOC
Springboot application that contains **Ingester** service that exposes a RestAPI endpoint where messages can be sent to. Messages received will then be sent to **IncomingTopic** (all messages) and **PI1Incoming** or **PI2Incoming** based on *source*

**StreamProcessor** will then consume all messages in IncomingTopic, transform it to JSON format, and route it to corresponding outgoing topics; **PI1Outgoing** and **PI2Outgoing**.

Parameters are loaded from resources/data
- partners.json - contains all primary partner data
-  partnerInterfaces.json - contains data for configuration of partner interfaces. Each entry will generate a topic
- routingCriteria.json - contains routing parameters to determine which outgoing topics will receive which message
		
			execution: "./mvnw spring-boot:run"

## Adapter
Springboot application that creates the server to which partner consumer can connect to. It contains a kafka listener that reads messages from **PI1Outgoing** and **PI2Outgoing** topics, and transforms the messages into XML format, and sends it to the connected consumer partner.

  		execution: “./mvnw spring-boot:run”
- Listens to port 9293 for partner connections

## Partner Simulators
Contains the python script to execute partner functionalities
- producer.py \*messageCount\* \*messageType\* \*destination\*-  
	- *messageCount* (optional, default = 1) - determines the number of XML messages that will be created
	- *messageType* (optional, default = -) - determines the message type to be set on the message header. If - is provided as value it will randomly pick from values: A,B,C
	- *destination* (optional) - determines the message type to be set on the message header. If 0 is provided as value it will randomly pick from values: 1,2,3, otherwise it will not be set in the header.

			execution: "python producer.py 10 -"
	-	generates XML messages based on template provided (template/default.xml) and puts random value on the following 
		- source (values: 3,6) to determine to which incoming topic it will be sent at initial ingestion, 
		- messageType (values: A,B,C) - criteria for routing 
		- destination (values: 1,2,3) - criteria for routing  
		- body (index|timestamp) for metrics. XML messages are sent to DatahubPOC via RestAPI endpoint (http://localhost:8080/datahub/)
		
- consumer.py \*partnerId\* \*port\* \*messageCount\*
	 - *partnerId* (mandatory) - used to set identify the partner when signing-on to the adapter
	 - *port* (optional, default = 9293) - determines the port on which the partner will connect to using localhost
	 - *messageCount* (optional, default = 0) - determines how many messages are expected to be received before the simulator terminates. If 0 is set, it will continue to read.
	 
			 execution: "python consumer.py 4 10"
	- connects and signs-on to adapter using *partnerId*, then consumes *messageCount* XML messages read from outgoing topics, displays the calculated elapsed time from which the message is generated by the producer up until it was received by this consumer. After all messages received it will display calculated messages per second.